@model IEnumerable<AttendanceReportResponse>
@{
    Layout = null;
    var ID = ViewBag.ID;
    var StudentsGrade = ViewBag.Students;
}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
</head>
<body>
    <div class="container mt-5">
        <form method="post" asp-action="FilterAttendanceReport" asp-controller="Student">

            <div class="form-group">
                <label for="startDate">Start Date:</label>
                <input type="date" class="form-control" id="startDate" name="startDate">
            </div>
            <div class="form-group">
                <label for="endDate">End Date:</label>
                <input type="date" class="form-control" id="endDate" name="endDate">
            </div>

            <div class="form-group">
                <label for="attendanceStatus">Attendance Status:</label>
                <select class="form-control" id="attendanceStatus" name="attendanceStatus">
                    <option value="2">Absent</option>
                    <option value="1">Late</option>
                    <option value="3">Present</option>
                </select>
            </div>

            <br />
            <button type="submit" class="btn btn-primary" id="filterBtn">Filter</button>

        </form>

        <form method="post" action="@Url.Action("ExportToExcel", "Student", new { ID = ID })">
            <button type="submit" class="btn btn-success mt-3">Export to Excel</button>
        </form>
    </div>



    @if(Model.Count() == 0)
    {

        <table id="departmentTable" class="table table-bordered table-hover m-3">
            <thead>
            <th>Date</th>
            <th>InTime</th>
            <th>OutTime</th>

              
                <th>Is Present</th>
             

              
                <th>Is Late</th>
             
              
                <th>Is Absent</th>
              

            <th>Grade</th>

            <th>UserName</th>
            </thead>
            </table>
        <h1>No Data Exist</h1>
        
    }else{


        <table id="departmentTable" class="table table-bordered table-hover m-3">
            <thead>
            <th>Date</th>
            <th>InTime</th>
            <th>OutTime</th>

                @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsPresent || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                {
                <th>Is Present</th>
                }

                @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsLate || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                {
                <th>Is Late</th>
                }
                @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsApsent || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                {
                <th>Is Absent</th>
                }

            <th>Grade</th>

            <th>UserName</th>
            </thead>
            <tbody>
                @if (Model.Count() == 0)
                {
                    <tr>
                        <td colspan="7">NO Attendance Data</td>
                    </tr>
                }
                else
                {
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.InDate</td>
                            <td>@item.InTime</td>
                            <td>@item.OutTime</td>

                            @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsPresent || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                            {
                                <td>@item.IsPresent</td>
                            }
                           


                            @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsLate || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                            {
                                <td>@item.IsLate</td>
                            }


                            @if (Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.IsApsent || Model.FirstOrDefault().AttendanceStatue == AttendanceEnum.All)
                            {
                                <td>@item.IsAbsent</td>
                            }

                            <td>@item.Grade</td>
                            <td>@item.userName</td>
                        </tr>
                    }
                }
            </tbody>
        </table>



    }

 

    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <sc@* ript>
        $(document).ready(function () {
            $("#filterBtn").click(function () {
                var startDate = new Date($("#startDate").val());
                var endDate = new Date($("#endDate").val());
                var statusFilter = $("#attendanceStatus").val();

                filterData(startDate, endDate, statusFilter);
            });
        });

        function filterData(startDate, endDate, statusFilter) {
            $("tbody tr").each(function () {
                var rowDate = new Date($(this).find("td:first").text());
                var isAbsent = $(this).find("td:nth-child(6)").text() === "True";
                var isLate = $(this).find("td:nth-child(7)").text() === "True";
                var isPresent = $(this).find("td:nth-child(8)").text() === "True";

                if ((rowDate >= startDate && rowDate <= endDate) &&
                    (statusFilter === "all" ||
                        (statusFilter === "absent" && isAbsent) ||
                        (statusFilter === "late" && isLate) ||
                        (statusFilter === "present" && isPresent))) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        } *@
    </script>
</body>
</html>
