@model IEnumerable<Attendence>

@{
    ViewData["Title"] = "GetStudentByTrackID";
    Layout = "~/Views/Shared/_mainLayout.cshtml";
    
}

<h1>GetStudentByTrackID</h1>

@{
    Layout = null;
    var ID = ViewBag.ID;
    List<Attendence> todayAtted = ViewBag.TodayAttend;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />

</head>
<body>


    @{
        ViewBag.Title = "Attendance";
    }


    <div class="container mt-5">
        <h1>Search For Students Here</h1>

        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Enter student name..." class="form-control form-control-lg mr-sm-2 ">
    </div>
    <table id="attendanceTable" class="table table-bordered table-hover m-3">
        <thead>

        <th align="center">ID</th>
        <th align="center">Name</th>
        <th align="center">Email</th>
        <th align="center">Date</th>
        <th align="center">Attendance</th>
        <th align="center">Leave</th>

        </thead>


        <tbody>
            @if (Model.Count() == 0)
            {
                <tr>
                    <td colspan="5">NO Students Exists</td>
                    <a href="c:\users\sherif\desktop\webdemo2\webdemo2\webdemo2\controllers\departmentcontroller.cs">c:\users\sherif\desktop\webdemo2\webdemo2\webdemo2\controllers\departmentcontroller.cs</a>
                </tr>
            }
            else
            {
                foreach (var item in Model)
                {
                    string buttonstate="";
                    string buttonleavstate = "";

                   @*  if (todayAtted.Any(att => att.User.Id == item.UserId))
                    {
                        buttonstate = "disabled";
                        if (todayAtted.Any(att => att.UserId == item.UserId && att.OutTime != null))
                        {
                            buttonleavstate = "disabled";
                        }
                    } *@

                    @* if (todayAtted.Any(att=>att.User.Id==item.UserId))
                    {
                        buttonstate = "disabled";
                        if (todayAtted.Any(att => att.UserId == item.UserId && att.OutTime != null))
                        {
                            buttonleavstate = "disabled";
                        }
                    } *@
                    
                    <tr >
                        <td>@item.Id</td>
                        <td>@item.User.Name</td>
                        <td>@item.User.Email</td>
                        <td>@item.Date</td>

                        @if (@item.InTime != null)
                        {
                            <td align="center">
                                <form method="post" onsubmit="confirmAttendance(this.querySelector('button'));"
                                      asp-action="ConfirmStudentAttendace" asp-controller="Security"
                                      asp-route-id="@item.Id" asp-route-id2="@item.TrackId">
                                    <button type="submit" disabled class="btn btn-outline-primary m-3">Confirm Attendance</button>
                                </form>
                            </td>
                        }
                        else
                        {
                            <td align="center">
                                <form method="post" onsubmit="confirmAttendance(this.querySelector('button'));"
                                      asp-action="ConfirmStudentAttendace" asp-controller="Security"
                                      asp-route-id="@item.Id" asp-route-id2="@item.TrackId">
                                    <button type="submit" class="btn btn-outline-primary m-3">Confirm Attendance</button>
                                </form>
                            </td>
                        }

                        @if (@item.InTime != null)
                        {
                            <td align="center">
                                <form method="post" asp-action="ConfirmStudentLeaving" asp-controller="Security" asp-route-id="@item.Id" asp-route-id2="@item.TrackId">
                                    <button type="submit" class="btn btn-outline-primary m-3">Confirm Leave</button>
                                </form>
                            </td>
                        }
                        else
                        {
                            <td align="center">
                                <form method="post" asp-action="ConfirmStudentLeaving" asp-controller="Security" asp-route-id="@item.Id" asp-route-id2="@item.TrackId">
                                    <button type="submit" disabled class="btn btn-outline-primary m-3">Confirm Leave</button>
                                </form>
                            </td>
                        }

                    </tr>
                }
            }

        </tbody>

    </table>
    </div>
    </div>
    </div>
    </div>



    <script>

        // function change () {
        //     debugger;
        //     showButton = false; // Initial value of the flag
        //     if (showButton) {
        //         console.log('Flag is true');
        //     } else {
        //         console.log('Flag is false');
        //     }

        //     // // Attach a click event handler to the button
        //     // $('#myButton').click(function () {
        //     //     flag = true; // Set the flag to true when the button is clicked
        //     //     console.log('Flag is now true');
        //     // });

        //     // You can use the flag variable elsewhere in your code
        //     // For example, you can check its value in another event handler

        //     // $('#anotherElement').click(function () {
        //     //     if (flag) {
        //     //         console.log('Flag is true');
        //     //     } else {
        //     //         console.log('Flag is false');
        //     //     }
        //     // });
        // };

        function filterTable() {
            // Declare variables
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("attendanceTable");
            tr = table.getElementsByTagName("tr");

            // Loop through all table rows, and hide those who don't match the search query
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[1]; // Assuming second column contains student names
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (txtValue.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
            function confirmAttendance(button) {
                // Disable the button to prevent multiple submissions
                button.disabled = true;

                // Perform any additional logic here, such as submitting the form asynchronously
            }
    </script>





    @*  <a asp-action="create" class="btn btn-success m-3">Add Student</a>*@
    <a class="btn btn-outline-primary m-3" asp-action="GetAllTracks" asp-controller="Security"> Back</a>

    
</body>
</html>
